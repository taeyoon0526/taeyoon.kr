<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    if (window.location.hostname === 'taeyoon.kr') {
      window.location.replace('https://contact.taeyoon.kr/visitor');
    }
  </script>
  <title>방문자 대시보드 | taeyoon.kr</title>
  <link rel="stylesheet" href="https://taeyoon.kr/visitor.css">
</head>

<body>
  <div class="dashboard-container">
    <header class="dashboard-header">
      <div>
        <h1>방문자 분석 대시보드</h1>
        <p class="dashboard-subtitle">taeyoon.kr 방문자 활동을 실시간으로 확인하세요.</p>
      </div>
      <div class="header-actions">
        <button id="themeToggleBtn" class="btn secondary theme-toggle" title="다크모드 전환">
          <span class="theme-icon">🌙</span>
        </button>
        <button id="refreshBtn" class="btn secondary">새로고침</button>
        <button id="exportBtn" class="btn">CSV 내보내기</button>
        <button id="logoutBtn" class="btn danger">로그아웃</button>
      </div>
    </header>

    <div id="statusBar" class="status-bar" role="status" aria-live="polite"></div>

    <section class="summary-grid">
      <article class="summary-card">
        <span class="summary-label">총 방문 수</span>
        <span class="summary-value" id="totalVisitorsValue">0</span>
        <span class="summary-meta">수집된 이벤트 중 방문(enter) 기준</span>
      </article>
      <article class="summary-card">
        <span class="summary-label">고유 세션</span>
        <span class="summary-value" id="uniqueSessionsValue">0</span>
        <span class="summary-meta">sessionId 기반 고유 방문자 수</span>
      </article>
      <article class="summary-card">
        <span class="summary-label">평균 체류시간</span>
        <span class="summary-value" id="averageDurationValue">00:00</span>
        <span class="summary-meta">leave 이벤트 기준(분:초)</span>
      </article>
      <article class="summary-card">
        <span class="summary-label">평균 로드 시간</span>
        <span class="summary-value" id="averageLoadTimeValue">—</span>
        <span class="summary-meta">페이지 로드 완료 시간</span>
      </article>
      <article class="summary-card">
        <span class="summary-label">상위 국가</span>
        <ul class="summary-top-list" id="topCountriesList"></ul>
      </article>
    </section>

    <section class="filters-card">
      <div class="filters-header">
        <div>
          <h2>필터</h2>
          <p class="filters-meta">원하는 조건으로 방문 데이터를 필터링하세요.</p>
        </div>
        <button type="button" class="btn tertiary filter-toggle" id="filterToggleBtn" aria-expanded="true"
          aria-controls="filterForm">필터 접기</button>
        <div class="loading-indicator" id="loadingIndicator">불러오는 중...</div>
      </div>
      <form id="filterForm" class="filter-form" novalidate>
        <div class="filter-group">
          <label for="filterCountry">국가</label>
          <select id="filterCountry" name="country">
            <option value="">모든 국가</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filterPage">페이지</label>
          <select id="filterPage" name="page">
            <option value="">모든 페이지</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filterDate">날짜</label>
          <input type="date" id="filterDate" name="date">
        </div>
        <div class="filter-actions">
          <button type="submit" class="btn secondary">적용</button>
          <button type="reset" class="btn secondary">초기화</button>
        </div>
      </form>
    </section>

    <section class="table-section">
      <div class="table-meta">
        <span id="resultCount">0개 결과</span>
        <span id="lastUpdated">최근 업데이트: —</span>
      </div>
      <div class="table-wrapper">
        <table class="visitor-table">
          <thead>
            <tr>
              <th>이벤트</th>
              <th>IP</th>
              <th>국가</th>
              <th>기기</th>
              <th>페이지</th>
              <th>체류시간</th>
              <th>페이지 로드</th>
              <th>DOM 준비</th>
              <th>리퍼러</th>
              <th>User Agent</th>
              <th>시간</th>
            </tr>
          </thead>
          <tbody id="visitorTableBody"></tbody>
        </table>
      </div>
      <div id="emptyState" class="empty-state" hidden>조건에 맞는 방문 기록이 없습니다.</div>

      <div class="pagination" id="pagination" hidden>
        <button id="prevPageBtn" class="btn secondary">이전</button>
        <span class="pagination-info" id="paginationInfo">1 / 1</span>
        <button id="nextPageBtn" class="btn secondary">다음</button>
        <select id="pageSizeSelect" class="page-size-select">
          <option value="50">50개씩</option>
          <option value="100" selected>100개씩</option>
          <option value="200">200개씩</option>
          <option value="500">500개씩</option>
        </select>
      </div>
    </section>

    <section class="stats-card">
      <div class="stats-header">
        <h2>📊 상세 통계</h2>
        <button id="toggleStatsBtn" class="btn tertiary">차트 보기</button>
      </div>
      <div id="statsContent" class="stats-content" hidden>
        <div class="chart-grid">
          <div class="chart-container">
            <h3>일별 방문 추이</h3>
            <canvas id="dailyVisitsChart"></canvas>
          </div>
          <div class="chart-container">
            <h3>기기별 분포</h3>
            <canvas id="deviceChart"></canvas>
          </div>
          <div class="chart-container">
            <h3>상위 국가</h3>
            <canvas id="countryChart"></canvas>
          </div>
          <div class="chart-container">
            <h3>시간대별 방문</h3>
            <canvas id="hourlyChart"></canvas>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script type="module" src="https://taeyoon.kr/visitor.js"></script>
</body>

</html>