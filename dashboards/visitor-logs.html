<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë°©ë¬¸ì ë¡œê·¸ | taeyoon.kr</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
    }

    .controls {
      background: white;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    select,
    input {
      padding: 10px;
      border: 2px solid #43e97b;
      border-radius: 8px;
      font-size: 1em;
    }

    .log-table {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #43e97b;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid #f0f0f0;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 600;
      display: inline-block;
    }

    .badge-success {
      background: #d4edda;
      color: #155724;
    }

    .badge-danger {
      background: #f8d7da;
      color: #721c24;
    }

    .badge-warning {
      background: #fff3cd;
      color: #856404;
    }

    .btn-back {
      display: inline-block;
      padding: 12px 30px;
      background: white;
      color: #43e97b;
      text-decoration: none;
      border-radius: 25px;
      font-weight: 600;
      margin: 20px 0;
      transition: transform 0.2s;
    }

    .btn-back:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .pagination {
      background: white;
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
      text-align: center;
    }

    .page-btn {
      padding: 8px 16px;
      margin: 0 5px;
      border: 2px solid #43e97b;
      background: white;
      color: #43e97b;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .page-btn:hover,
    .page-btn.active {
      background: #43e97b;
      color: white;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      h1 {
        font-size: 2em;
        margin-bottom: 20px;
      }

      .controls {
        flex-direction: column;
        padding: 15px;
        gap: 10px;
        align-items: stretch;
      }

      .controls label {
        font-size: 0.9em;
      }

      select,
      input {
        width: 100%;
        padding: 8px;
        font-size: 0.9em;
      }

      .log-table {
        overflow-x: auto;
      }

      table {
        font-size: 0.85em;
        min-width: 800px;
      }

      th,
      td {
        padding: 10px 8px;
      }

      .btn-back {
        padding: 10px 20px;
        font-size: 0.9em;
        margin: 15px 0;
      }

      .pagination {
        padding: 15px;
      }

      .page-btn {
        padding: 6px 12px;
        font-size: 0.9em;
        margin: 0 3px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.6em;
      }

      .controls {
        padding: 12px;
      }

      table {
        font-size: 0.75em;
        min-width: 700px;
      }

      th,
      td {
        padding: 8px 6px;
      }

      .btn-back {
        display: block;
        text-align: center;
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ“‹ ë°©ë¬¸ì ë¡œê·¸</h1>
    <a href="/admin" class="btn-back">â† Admin Dashboardë¡œ ëŒì•„ê°€ê¸°</a>

    <div class="controls">
      <label>ë³´ê¸°:</label>
      <select id="limitSelect" title="í˜ì´ì§€ë‹¹ í‘œì‹œ ê°œìˆ˜ ì„ íƒ" onchange="changeLimit(this.value)">
        <option value="10">10ê°œ</option>
        <option value="50" selected>50ê°œ</option>
        <option value="100">100ê°œ</option>
        <option value="500">500ê°œ</option>
      </select>
      <input type="search" placeholder="IP ë˜ëŠ” êµ­ê°€ë¡œ ê²€ìƒ‰..." id="searchInput" oninput="filterLogs()">
    </div>

    <div class="log-table">
      <table id="logsTable">
        <thead>
          <tr>
            <th>ì‹œê°„</th>
            <th>IP ì£¼ì†Œ</th>
            <th>êµ­ê°€</th>
            <th>ê²½ë¡œ</th>
            <th>ë¸Œë¼ìš°ì €</th>
            <th>OS</th>
            <th>ìƒíƒœ</th>
          </tr>
        </thead>
        <tbody id="logBody">
          <tr>
            <td colspan="7" style="text-align: center; padding: 30px;">
              <div style="font-size: 2em; margin-bottom: 10px;">ğŸ”„</div>
              <div>ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <button class="page-btn" onclick="changePage({{PREV_PAGE}})" {{PREV_DISABLED}}>â† ì´ì „</button>
      <button class="page-btn active">{{CURRENT_PAGE}}</button>
      <button class="page-btn" onclick="changePage({{NEXT_PAGE}})">ë‹¤ìŒ â†’</button>
    </div>
  </div>

  <script>
    let allLogs = [];
    let currentLimit = {{LIMIT}};
    let currentPage = {{PAGE}};

    // Set select option based on limit
    document.getElementById('limitSelect').value = currentLimit;

    async function loadLogs() {
      try {
        // ì‹¤ì œ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜ - ì¶”í›„ KVì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        allLogs = generateSampleLogs(currentLimit);
        renderLogs(allLogs);
      } catch (error) {
        console.error('Failed to load logs:', error);
        document.getElementById('logBody').innerHTML =
          '<tr><td colspan="7" style="text-align: center; padding: 30px; color: #e74c3c;"><div style="font-size: 2em; margin-bottom: 10px;">âŒ</div><div>ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div></td></tr>';
      }
    }

    function generateSampleLogs(count) {
      const logs = [];
      const countries = [
        { code: 'KR', flag: 'ğŸ‡°ğŸ‡·', name: 'Korea' },
        { code: 'US', flag: 'ğŸ‡ºğŸ‡¸', name: 'United States' },
        { code: 'JP', flag: 'ğŸ‡¯ğŸ‡µ', name: 'Japan' },
        { code: 'CN', flag: 'ğŸ‡¨ğŸ‡³', name: 'China' },
        { code: 'RU', flag: 'ğŸ‡·ğŸ‡º', name: 'Russia' },
        { code: 'DE', flag: 'ğŸ‡©ğŸ‡ª', name: 'Germany' }
      ];
      const browsers = ['Chrome 119', 'Firefox 120', 'Safari 17', 'Edge 119', 'Opera 105'];
      const os = ['Windows 11', 'macOS 14', 'Linux', 'iOS 17', 'Android 14'];
      const paths = ['/', '/admin', '/visitor/dashboard', '/ip', '/api/visitors'];
      const statuses = [
        { text: 'âœ… í—ˆìš©', class: 'success' },
        { text: 'ğŸš« ì°¨ë‹¨', class: 'danger' },
        { text: 'âš ï¸ ì˜ì‹¬', class: 'warning' }
      ];

      for (let i = 0; i < count; i++) {
        const date = new Date(Date.now() - i * 60000 * Math.random() * 10);
        const country = countries[Math.floor(Math.random() * countries.length)];
        const status = statuses[Math.floor(Math.random() * statuses.length)];

        logs.push({
          time: date.toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
          }),
          ip: generateRandomIP(),
          country: country.flag + ' ' + country.code,
          path: paths[Math.floor(Math.random() * paths.length)],
          browser: browsers[Math.floor(Math.random() * browsers.length)],
          os: os[Math.floor(Math.random() * os.length)],
          status: status
        });
      }
      return logs;
    }

    function generateRandomIP() {
      return Array(4).fill(0).map(() => Math.floor(Math.random() * 256)).join('.');
    }

    function renderLogs(logs) {
      const tbody = document.getElementById('logBody');
      if (!logs || logs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;"><div style="font-size: 2em; margin-bottom: 10px;">ğŸ“­</div><div>ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div></td></tr>';
        return;
      }

      tbody.innerHTML = logs.map(function (log) {
        return '<tr>' +
          '<td style="white-space: nowrap;">' + log.time + '</td>' +
          '<td><code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px; font-family: Monaco, monospace;">' + log.ip + '</code></td>' +
          '<td>' + log.country + '</td>' +
          '<td><code style="color: #667eea;">' + log.path + '</code></td>' +
          '<td>' + log.browser + '</td>' +
          '<td>' + log.os + '</td>' +
          '<td><span class="badge badge-' + log.status.class + '">' + log.status.text + '</span></td>' +
          '</tr>';
      }).join('');
    }

    function changeLimit(limit) {
      window.location.href = '/visitor/logs?limit=' + limit + '&page=1';
    }

    function changePage(page) {
      window.location.href = '/visitor/logs?limit=' + currentLimit + '&page=' + page;
    }

    function filterLogs() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.querySelectorAll('#logBody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(search) ? '' : 'none';
      });
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°
    loadLogs();
  </script>
</body>

</html>